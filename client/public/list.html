<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>HouseFinder | List View</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://bootswatch.com/4/lux/bootstrap.min.css">
  </head>
  <body>
    <!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="#">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <div id="root"></div>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <!-- Bootstrap -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <!-- React DOM -->
    <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/babel-standalone@6.26.0/babel.js"></script>

    <script type="text/babel">
    const rootElement = document.getElementById('root');

    function Header() {
      return <h1>List View</h1>;
    }

    function MapLink() {
      return (
        <div>
          <a href="/map.html">Back to Map View</a>
        </div>
      );
    }

    function HomeLink() {
      return (
        <div>
          <a href="/">Back to Home</a>
        </div>
      );
    }

    class Listings extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          error: null,
          isLoaded: false,
          locations: [],
        };
      }

      componentDidMount() {
        fetch('/api/subregion?state="wa"&county="king"&city="seattle"')
          .then(res => res.json())
          .then(
            result => {
              this.setState({
                isLoaded: true,
                locations: result,
              });
          },
            error => {
              this.setState({
                isLoaded: true,
                error,
              });
            },
          );
      }

      render() {
        const { error, isLoaded, locations } = this.state;
        if (error) {
          return <div>Error: {error.message}</div>;
        } else if (!isLoaded) {
          return <div>Loading...</div>;
        } else {
          return (
            <div>
              <h2>
                Results for {locations.request.city.slice(1, -1)},{' '}
                {locations.request.state.slice(1, -1)}
              </h2>

              <table className="table">
                <thead>
                  <tr>
                    <th>Zip Code</th>

                    <th>Price</th>
                  </tr>
                </thead>
                <tbody>
                  {locations.response.list.region.map((location, i) => (
                    <tr key={i}>
                      <td>{location.name[0]}</td>
                      <td>
                        {location.zindex ? '$' + location.zindex[0]['_'] : 'Unavailable'}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          );
        }
      }
    }

    function App() {
      return (
        <div>
          <Header />
          <MapLink />
          <HomeLink />
          <Listings />
        </div>
      );
    }

    ReactDOM.render(<App />, rootElement);
    </script>

  </body>
</html>
